{"title":"CFNetwork 编程指南之七: 使用网络诊断(Using Network Diagnostics)","uid":"a234db355cc14ca7a21f932753cfdf5a","slug":"CFNetwork-编程指南之七-使用网络诊断-Using-Network-Diagnostics","date":"2016-08-10T03:59:13.000Z","updated":"2016-08-19T11:43:58.000Z","comments":true,"path":"api/articles/CFNetwork-编程指南之七-使用网络诊断-Using-Network-Diagnostics.json","keywords":null,"cover":null,"content":"<p>#使用网络诊断</p>\n<p>在许多基于网络的应用中，会发生基于网络的错误，这些错误与你的应用无关。然而，大多数用户可能不知道为什么应用失败。CFNetDiagnostics API为你提供一种快速而简单的方法来帮助用户解决网络问题。</p>\n<p>如果你的应用使用一个CFStream 对象，然后调用<a href=\"https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFNetDiagnosticsRef/index.html#//apple_ref/doc/c_ref/CFNetDiagnosticCreateWithStreams\">CFNetDiagnosticCreateWithStreams</a>函数创建一个网络诊断引用(CFNetDiagnosticRef) 。<a href=\"https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFNetDiagnosticsRef/index.html#//apple_ref/doc/c_ref/CFNetDiagnosticCreateWithStreams\">CFNetDiagnosticCreateWithStreams</a>有一个分配器，读取流和写入流作为参数。如果你的应用只使用读取流或写入流，未使用的参数设置为NULL。</p>\n<p>如果不存在流，你还可以直接从URL创建一个网络诊断引用。要做到这一点，调用<a href=\"https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFNetDiagnosticsRef/index.html#//apple_ref/doc/c_ref/CFNetDiagnosticCreateWithURL\">CFNetDiagnosticCreateWithURL</a> 函数，并传递一个分配器，URL到CFURLRef。它将返回一个网络诊断引用供你使用。</p>\n<p>为了通过网络诊断助手诊断问题，调用<a href=\"https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFNetDiagnosticsRef/index.html#//apple_ref/doc/c_ref/CFNetDiagnosticDiagnoseProblemInteractively\">CFNetDiagnosticDiagnoseProblemInteractively</a> 函数并传递网络诊断引用。列表6-1展示了如何使用CFNetDiagnostics 诊断在运行循环上实现的流。</p>\n<p>列表6-1 当发生流错误时使用CFNetDiagnostics API</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token keyword\">case</span> kCFStreamEventErrorOccurred<span class=\"token operator\">:</span> \n\n    CFNetDiagnosticRef diagRef <span class=\"token operator\">=</span>\n        <span class=\"token function\">CFNetDiagnosticCreateWithStreams</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> stream<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token function\">CFNetDiagnosticDiagnoseProblemInteractively</span><span class=\"token punctuation\">(</span>diagRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    CFStreamError error <span class=\"token operator\">=</span> <span class=\"token function\">CFReadStreamGetError</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">reportError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">CFReadStreamClose</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">CFRelease</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<span id=\"more\"></span>\n<p>CFNetworkDiagnostics 同样可以检索问题的状态，而不是使用网络诊断助手。通过调用<a href=\"https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFNetDiagnosticsRef/index.html#//apple_ref/doc/c_ref/CFNetDiagnosticCopyNetworkStatusPassively\">CFNetDiagnosticCopyNetworkStatusPassively</a>，便可以完成。该函数返回一个常数例如<code>kCFNetDiagnosticConnectionUp</code> 或<code>kCFNetDiagnosticConnectionIndeterminate。</code></p>\n<p>官方原文地址：<br><a href=\"https://developer.apple.com/library/ios/documentation/Networking/Conceptual/CFNetwork/UsingNetworkDiagnostics/UsingNetworkDiagnostics.html#//apple_ref/doc/uid/TP30001132-CH7-SW1\">CFNetwork Programming Guide</a></p>\n","text":"#使用网络诊断 在许多基于网络的应用中，会发生基于网络的错误，这些错误与你的应用无关。然而，大多数用户可能不知道为什么应用失败。CFNetDiagnostics API为你提供一种快速而简单的方法来帮助用户解决网络问题。 如果你的应用使用一个CFStream 对象，然后调用CFN...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"iOS网络编程","slug":"iOS网络编程","count":9,"path":"api/categories/iOS网络编程.json"}],"tags":[{"name":"CFNetwork","slug":"CFNetwork","count":7,"path":"api/tags/CFNetwork.json"}],"toc":"","author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}},"mapped":true,"prev_post":{"title":"HomeKit 开发指南","uid":"79d37eeff247a26cb1e49e04acbf72e8","slug":"HomeKit-开发指南","date":"2016-08-10T05:08:12.000Z","updated":"2016-08-14T06:22:07.000Z","comments":true,"path":"api/articles/HomeKit-开发指南.json","keywords":null,"cover":[],"text":"#第一部分：简介 该文档旨在帮你编写HomeKit app。HomeKit库是用来沟通和控制家庭自动化配件的，这些家庭自动化配件都支持苹果的HomeKit Accessory Protocol。HomeKit应用程序可让 用户发现兼容配件并配置它们。用户可以创建一些action来...","link":"","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[{"name":"智能家居","slug":"智能家居","count":2,"path":"api/categories/智能家居.json"}],"tags":[{"name":"HomeKit","slug":"HomeKit","count":2,"path":"api/tags/HomeKit.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}},"next_post":{"title":"CFNetwork 编程指南之六: 使用FTP服务器(Working with FTP Servers)","uid":"4fe0927b9d7f454761510969d0dea921","slug":"CFNetwork-编程指南之六-使用FTP服务器-Working-with-FTP-Servers","date":"2016-08-10T03:58:41.000Z","updated":"2016-08-19T11:45:52.000Z","comments":true,"path":"api/articles/CFNetwork-编程指南之六-使用FTP服务器-Working-with-FTP-Servers.json","keywords":null,"cover":null,"text":"#使用FTP服务器 本文揭示了如何使用CFFTP API的一些基本特性。管理FTP事务是异步执行的，而管理文件传输是同步实现的。 ##下载文件使用CFFTP类似于CFHTTP ，因为它们都是基于CFStream。与其他任何异步使用CFStream的API一样，使用CFFTP下载一...","link":"","photos":[],"count_time":{"symbolsCount":"8k","symbolsTime":"7 mins."},"categories":[{"name":"iOS网络编程","slug":"iOS网络编程","count":9,"path":"api/categories/iOS网络编程.json"}],"tags":[{"name":"CFNetwork","slug":"CFNetwork","count":7,"path":"api/tags/CFNetwork.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}}}