{"title":"iOS IAP编程","uid":"764f313455c7e408a84478db15d0ac63","slug":"iOS-IAP编程","date":"2016-08-08T15:00:04.000Z","updated":"2019-05-14T04:53:32.000Z","comments":true,"path":"api/articles/iOS-IAP编程.json","keywords":null,"cover":[],"content":"<p>#协议</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap1.png\"></p>\n<span id=\"more\"></span>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap2.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap3.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap4.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap5.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap6.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap7.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap8.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap9.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap10.png\"></p>\n<p><img src=\"https://e.czbank.com/CORPORBANK/query_unionBank_index.jsp\" alt=\"CNAPS CODE 查询地址\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap11.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap12.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap13.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap14.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap15.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap16.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap17.jpg\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap18.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap19.png\"></p>\n<p>#创建内购项目</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap20.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap21.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap22.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap23.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap24.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap25.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap26.png\"></p>\n<p>#添加内购项目测试账号</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap27.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledeveloperiap28.png\"></p>\n<p>#实现代码</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">首先导入<span class=\"token builtin\">StoreKit</span><span class=\"token punctuation\">.</span>framework库\n\n<span class=\"token punctuation\">.</span>h文件\n\n#define <span class=\"token constant\">kSandboxVerifyURL</span> @<span class=\"token string\">\"https://sandbox.itunes.apple.com/verifyReceipt\"</span> <span class=\"token comment\">//开发阶段沙盒验证URL</span>\n#define <span class=\"token constant\">kAppStoreVerifyURL</span> @<span class=\"token string\">\"https://buy.itunes.apple.com/verifyReceipt\"</span> <span class=\"token comment\">//实际购买验证URL</span>\n#<span class=\"token keyword\">import</span> <span class=\"token operator\">&lt;</span><span class=\"token builtin\">StoreKit</span><span class=\"token operator\">/</span><span class=\"token builtin\">StoreKit</span><span class=\"token punctuation\">.</span>h<span class=\"token operator\">></span>\n\n\n\n\n<span class=\"token keyword\">enum</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token builtin\">IAP0p20</span><span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">IAP1p100</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">IAP4p600</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">IAP9p1000</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">IAP24p6000</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span>buyCoinsTag<span class=\"token punctuation\">;</span>\n\n\n\n\n\n<span class=\"token comment\">//代理</span>\n@interface <span class=\"token class-name\">RechargeVC</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token operator\">&lt;</span><span class=\"token builtin\">SKPaymentTransactionObserver</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">SKProductsRequestDelegate</span> <span class=\"token operator\">></span>\n<span class=\"token punctuation\">&#123;</span>\nint buyType<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> requestProUpgradeProductData<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span><span class=\"token builtin\">RequestProductData</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>buy<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>int<span class=\"token punctuation\">)</span>type<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>paymentQueue<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentQueue</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>queue updatedTransactions<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transactions<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> <span class=\"token builtin\">PurchasedTransaction</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> completeTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> failedTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> paymentQueueRestoreCompletedTransactionsFinished<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> paymentQueue<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentQueue</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> paymentQueue restoreCompletedTransactionsFailedWithError<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSError</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>error<span class=\"token punctuation\">;</span>\n\n\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> restoreTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>provideContent<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>product<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>recordTransaction<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>product<span class=\"token punctuation\">;</span>\n\n\n@end\n<span class=\"token punctuation\">.</span>m文件\n\n#<span class=\"token keyword\">import</span> <span class=\"token string\">\"RechargeVC.h\"</span>\n\n\n<span class=\"token comment\">//在内购项目中创的商品单号</span>\n#define <span class=\"token builtin\">ProductID_IAP0p20</span> @<span class=\"token string\">\"Nada.JPYF01\"</span><span class=\"token comment\">//20</span>\n#define <span class=\"token builtin\">ProductID_IAP1p100</span> @<span class=\"token string\">\"Nada.JPYF02\"</span> <span class=\"token comment\">//100</span>\n#define <span class=\"token builtin\">ProductID_IAP4p600</span> @<span class=\"token string\">\"Nada.JPYF03\"</span> <span class=\"token comment\">//600</span>\n#define <span class=\"token builtin\">ProductID_IAP9p1000</span> @<span class=\"token string\">\"Nada.JPYF04\"</span> <span class=\"token comment\">//1000</span>\n#define <span class=\"token builtin\">ProductID_IAP24p6000</span> @<span class=\"token string\">\"Nada.JPYF05\"</span> <span class=\"token comment\">//6000</span>\n\n\n\n@interface <span class=\"token class-name\">RechargeVC</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n@end\n\n\n@implementation <span class=\"token builtin\">RechargeVC</span>\n\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>viewDidLoad <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">super</span> viewDidLoad<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> addTransactionObserver<span class=\"token punctuation\">:</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> buy<span class=\"token punctuation\">:</span><span class=\"token builtin\">IAP0p20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>buy<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>int<span class=\"token punctuation\">)</span>type\n<span class=\"token punctuation\">&#123;</span>\n    buyType <span class=\"token operator\">=</span> type<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> canMakePayments<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> <span class=\"token builtin\">RequestProductData</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"允许程序内付费购买\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">else</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"不允许程序内付费购买\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">UIAlertView</span> <span class=\"token operator\">*</span>alerView <span class=\"token operator\">=</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">UIAlertView</span> alloc<span class=\"token punctuation\">]</span> initWithTitle<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"提示\"</span>\n    message<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"您的手机没有打开程序内付费购买\"</span>\n    delegate<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span> cancelButtonTitle<span class=\"token punctuation\">:</span><span class=\"token function\">NSLocalizedString</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"关闭\"</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span> otherButtonTitles<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span>alerView show<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span><span class=\"token builtin\">RequestProductData</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"---------请求对应的产品信息------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span>product <span class=\"token operator\">=</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>buyType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP0p20</span><span class=\"token punctuation\">:</span>\n        product<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP0p20</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP1p100</span><span class=\"token punctuation\">:</span>\n        product<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP1p100</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP4p600</span><span class=\"token punctuation\">:</span>\n        product<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP4p600</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP9p1000</span><span class=\"token punctuation\">:</span>\n        product<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP9p1000</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP24p6000</span><span class=\"token punctuation\">:</span>\n        product<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP24p6000</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token builtin\">NSSet</span> <span class=\"token operator\">*</span>nsset <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">NSSet</span> setWithArray<span class=\"token punctuation\">:</span>product<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token builtin\">SKProductsRequest</span> <span class=\"token operator\">*</span>request<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKProductsRequest</span> alloc<span class=\"token punctuation\">]</span> initWithProductIdentifiers<span class=\"token punctuation\">:</span> nsset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\nrequest<span class=\"token punctuation\">.</span>delegate<span class=\"token operator\">=</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">[</span>request start<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">//&lt;SKProductsRequestDelegate> 请求协议</span>\n<span class=\"token comment\">//收到的产品信息</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>productsRequest<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKProductsRequest</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>request didReceiveResponse<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKProductsResponse</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>response<span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----------收到产品反馈信息--------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span>myProduct <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>products<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"产品Product ID:%@\"</span><span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">.</span>invalidProductIdentifiers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"产品付费数量: %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>int<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>myProduct <span class=\"token builtin\">count</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// populate UI</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKProduct</span> <span class=\"token operator\">*</span>product <span class=\"token keyword\">in</span> myProduct<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"product info\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"SKProduct 描述信息%@\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>product description<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"产品标题 %@\"</span> <span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span>localizedTitle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"产品描述信息: %@\"</span> <span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span>localizedDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"价格: %@\"</span> <span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"Product id: %@\"</span> <span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span>productIdentifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token builtin\">SKPayment</span> <span class=\"token operator\">*</span>payment <span class=\"token operator\">=</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>buyType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP0p20</span><span class=\"token punctuation\">:</span>\n        payment  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPayment</span> paymentWithProductIdentifier<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP0p20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//支付25</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP1p100</span><span class=\"token punctuation\">:</span>\n        payment  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPayment</span> paymentWithProductIdentifier<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP1p100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//支付108</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP4p600</span><span class=\"token punctuation\">:</span>\n        payment  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPayment</span> paymentWithProductIdentifier<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP4p600</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//支付618</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP9p1000</span><span class=\"token punctuation\">:</span>\n        payment  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPayment</span> paymentWithProductIdentifier<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP9p1000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//支付1048</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">IAP24p6000</span><span class=\"token punctuation\">:</span>\n        payment  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPayment</span> paymentWithProductIdentifier<span class=\"token punctuation\">:</span><span class=\"token builtin\">ProductID_IAP24p6000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//支付5898</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"---------发送购买请求------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> addPayment<span class=\"token punctuation\">:</span>payment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>requestProUpgradeProductData\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"------请求升级数据---------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSSet</span> <span class=\"token operator\">*</span>productIdentifiers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">NSSet</span> setWithObject<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"com.productid\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">SKProductsRequest</span><span class=\"token operator\">*</span> productsRequest <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKProductsRequest</span> alloc<span class=\"token punctuation\">]</span> initWithProductIdentifiers<span class=\"token punctuation\">:</span>productIdentifiers<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    productsRequest<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span>productsRequest start<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token comment\">//弹出错误信息</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>request<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKRequest</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>request didFailWithError<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSError</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>error<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-------弹出错误信息----------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">UIAlertView</span> <span class=\"token operator\">*</span>alerView <span class=\"token operator\">=</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">UIAlertView</span> alloc<span class=\"token punctuation\">]</span> initWithTitle<span class=\"token punctuation\">:</span><span class=\"token function\">NSLocalizedString</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"Alert\"</span><span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> message<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span>error localizedDescription<span class=\"token punctuation\">]</span>\n    delegate<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span> cancelButtonTitle<span class=\"token punctuation\">:</span><span class=\"token function\">NSLocalizedString</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"Close\"</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span> otherButtonTitles<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span>alerView show<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> requestDidFinish<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKRequest</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>request\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"----------反馈信息结束--------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> <span class=\"token builtin\">PurchasedTransaction</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----PurchasedTransaction----\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span>transactions <span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSArray</span> alloc<span class=\"token punctuation\">]</span> initWithObjects<span class=\"token punctuation\">:</span>transaction<span class=\"token punctuation\">,</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> paymentQueue<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> updatedTransactions<span class=\"token punctuation\">:</span>transactions<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">//&lt;SKPaymentTransactionObserver> 千万不要忘记绑定，代码如下：</span>\n<span class=\"token comment\">//----监听购买结果</span>\n<span class=\"token comment\">//[[SKPaymentQueue defaultQueue] addTransactionObserver:self];</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>paymentQueue<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentQueue</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>queue updatedTransactions<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transactions<span class=\"token comment\">//交易结果</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----paymentQueue--------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span>transaction <span class=\"token keyword\">in</span> transactions<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>transaction<span class=\"token punctuation\">.</span>transactionState<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token builtin\">SKPaymentTransactionStatePurchased</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//交易完成</span>\n            <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> completeTransaction<span class=\"token punctuation\">:</span>transaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----交易完成 --------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">//购买成功后进行验证</span>\n            <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> verifyPurchaseWithPaymentTransaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">SKPaymentTransactionStateFailed</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>交易失败\n            <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> failedTransaction<span class=\"token punctuation\">:</span>transaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----交易失败 --------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token builtin\">UIAlertView</span> <span class=\"token operator\">*</span>alerView2 <span class=\"token operator\">=</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">UIAlertView</span> alloc<span class=\"token punctuation\">]</span> initWithTitle<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"提示\"</span>\n            message<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"购买失败，请重新尝试购买\"</span>\n            delegate<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span> cancelButtonTitle<span class=\"token punctuation\">:</span><span class=\"token function\">NSLocalizedString</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"关闭\"</span><span class=\"token punctuation\">,</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span> otherButtonTitles<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token punctuation\">[</span>alerView2 show<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token builtin\">SKPaymentTransactionStateRestored</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>已经购买过该商品\n            <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> restoreTransaction<span class=\"token punctuation\">:</span>transaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----已经购买过该商品 --------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token builtin\">SKPaymentTransactionStatePurchasing</span><span class=\"token punctuation\">:</span>      <span class=\"token comment\">//商品添加进列表</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----商品添加进列表 --------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">/**\n*  验证购买，避免越狱软件模拟苹果请求达到非法购买问题\n*\n*/</span>\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>verifyPurchaseWithPaymentTransaction<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">//从沙盒中获取交易凭证并且拼接成请求体数据</span>\n    <span class=\"token constant\">NSURL</span> <span class=\"token operator\">*</span>receiptUrl<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSBundle</span> mainBundle<span class=\"token punctuation\">]</span> appStoreReceiptURL<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSData</span> <span class=\"token operator\">*</span>receiptData<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSData</span> dataWithContentsOfURL<span class=\"token punctuation\">:</span>receiptUrl<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span>receiptString<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>receiptData base64EncodedStringWithOptions<span class=\"token punctuation\">:</span><span class=\"token builtin\">NSDataBase64EncodingEndLineWithLineFeed</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//转化为base64字符串</span>\n\n    <span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span>bodyString <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">NSString</span> stringWithFormat<span class=\"token punctuation\">:</span>@<span class=\"token string\">\"&#123;\\\"receipt-data\\\" : \\\"%@\\\"&#125;\"</span><span class=\"token punctuation\">,</span> receiptString<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//拼接请求数据</span>\n    <span class=\"token builtin\">NSData</span> <span class=\"token operator\">*</span>bodyData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>bodyString dataUsingEncoding<span class=\"token punctuation\">:</span><span class=\"token builtin\">NSUTF8StringEncoding</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//创建请求到苹果官方进行购买验证</span>\n    <span class=\"token constant\">NSURL</span> <span class=\"token operator\">*</span>url<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token constant\">NSURL</span> <span class=\"token builtin\">URLWithString</span><span class=\"token punctuation\">:</span><span class=\"token constant\">kSandboxVerifyURL</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSMutableURLRequest</span> <span class=\"token operator\">*</span>requestM<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSMutableURLRequest</span> requestWithURL<span class=\"token punctuation\">:</span>url<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    requestM<span class=\"token punctuation\">.</span><span class=\"token builtin\">HTTPBody</span><span class=\"token operator\">=</span>bodyData<span class=\"token punctuation\">;</span>\n    requestM<span class=\"token punctuation\">.</span><span class=\"token builtin\">HTTPMethod</span><span class=\"token operator\">=</span>@<span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//创建连接并发送同步请求</span>\n    <span class=\"token builtin\">NSError</span> <span class=\"token operator\">*</span>error<span class=\"token operator\">=</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSData</span> <span class=\"token operator\">*</span>responseData<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSURLConnection</span> sendSynchronousRequest<span class=\"token punctuation\">:</span>requestM returningResponse<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span> error<span class=\"token punctuation\">:</span><span class=\"token operator\">&amp;</span>error<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"验证购买过程中发生错误，错误信息：%@\"</span><span class=\"token punctuation\">,</span>error<span class=\"token punctuation\">.</span>localizedDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token builtin\">NSDictionary</span> <span class=\"token operator\">*</span>dic<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSJSONSerialization</span> <span class=\"token builtin\">JSONObjectWithData</span><span class=\"token punctuation\">:</span>responseData options<span class=\"token punctuation\">:</span><span class=\"token builtin\">NSJSONReadingAllowFragments</span> error<span class=\"token punctuation\">:</span><span class=\"token constant\">nil</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"%@\"</span><span class=\"token punctuation\">,</span>dic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>dic<span class=\"token punctuation\">[</span>@<span class=\"token string\">\"status\"</span><span class=\"token punctuation\">]</span> intValue<span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"购买成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin\">NSDictionary</span> <span class=\"token operator\">*</span>dicReceipt<span class=\"token operator\">=</span> dic<span class=\"token punctuation\">[</span>@<span class=\"token string\">\"receipt\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin\">NSDictionary</span> <span class=\"token operator\">*</span>dicInApp<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>dicReceipt<span class=\"token punctuation\">[</span>@<span class=\"token string\">\"in_app\"</span><span class=\"token punctuation\">]</span> firstObject<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span>productIdentifier<span class=\"token operator\">=</span> dicInApp<span class=\"token punctuation\">[</span>@<span class=\"token string\">\"product_id\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//读取产品标识</span>\n        <span class=\"token comment\">//如果是消耗品则记录购买数量，非消耗品则记录是否购买过</span>\n        <span class=\"token builtin\">NSUserDefaults</span> <span class=\"token operator\">*</span>defaults<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSUserDefaults</span> standardUserDefaults<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>productIdentifier isEqualToString<span class=\"token punctuation\">:</span>kProductID3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            int purchasedCount<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>defaults integerForKey<span class=\"token punctuation\">:</span>productIdentifier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//已购买数量</span>\n            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSUserDefaults</span> standardUserDefaults<span class=\"token punctuation\">]</span> setInteger<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>purchasedCount<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> forKey<span class=\"token punctuation\">:</span>productIdentifier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token punctuation\">[</span>defaults setBool<span class=\"token punctuation\">:</span><span class=\"token constant\">YES</span> forKey<span class=\"token punctuation\">:</span>productIdentifier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView reloadData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//在此处对购买记录进行存储，可以存储到开发商的服务器端</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"购买失败，未通过验证！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> completeTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction\n\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----completeTransaction--------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Your application should implement these two methods.</span>\n    <span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span>product <span class=\"token operator\">=</span> transaction<span class=\"token punctuation\">.</span>payment<span class=\"token punctuation\">.</span>productIdentifier<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>product length<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token builtin\">NSArray</span> <span class=\"token operator\">*</span>tt <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>product componentsSeparatedByString<span class=\"token punctuation\">:</span>@<span class=\"token string\">\".\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span>bookid <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>tt lastObject<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>bookid length<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> recordTransaction<span class=\"token punctuation\">:</span>bookid<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token keyword\">self</span> provideContent<span class=\"token punctuation\">:</span>bookid<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">// Remove the transaction from the payment queue.</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> finishTransaction<span class=\"token punctuation\">:</span> transaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">//记录交易</span>\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>recordTransaction<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>product<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----记录交易--------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">//处理下载内容</span>\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>provideContent<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSString</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>product<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-----下载--------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> failedTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>transaction<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">.</span>code <span class=\"token operator\">!=</span> <span class=\"token builtin\">SKErrorPaymentCancelled</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> finishTransaction<span class=\"token punctuation\">:</span> transaction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> paymentQueueRestoreCompletedTransactionsFinished<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction<span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> restoreTransaction<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentTransaction</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>transaction\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\" 交易恢复处理\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span> paymentQueue<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">SKPaymentQueue</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> paymentQueue restoreCompletedTransactionsFailedWithError<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSError</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>error<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"-------paymentQueue----\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n#pragma mark connection delegate\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>connection<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSURLConnection</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>connection didReceiveData<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSData</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>data\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"%@\"</span><span class=\"token punctuation\">,</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">NSString</span> alloc<span class=\"token punctuation\">]</span> initWithData<span class=\"token punctuation\">:</span>data encoding<span class=\"token punctuation\">:</span><span class=\"token builtin\">NSUTF8StringEncoding</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>connectionDidFinishLoading<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSURLConnection</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>connection<span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>connection<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSURLConnection</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>connection didReceiveResponse<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSURLResponse</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>response<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSHTTPURLResponse</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>response statusCode<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">206</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">304</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">400</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">404</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">416</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">403</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">401</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">500</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>connection<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSURLConnection</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>connection didFailWithError<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSError</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>error <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span>@<span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token operator\">-</span><span class=\"token punctuation\">(</span>void<span class=\"token punctuation\">)</span>dealloc\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">SKPaymentQueue</span> defaultQueue<span class=\"token punctuation\">]</span> removeTransactionObserver<span class=\"token punctuation\">:</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//解除监听</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n@end<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","text":"#协议 #创建内购项目 #添加内购项目测试账号 #实现代码 首先导入StoreKit.framework库 .h文件 #define kSandboxVerifyURL @\"https://sandbox.itunes.apple.com/verifyReceipt\" //开发阶...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":18,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"IAP","slug":"IAP","count":1,"path":"api/tags/IAP.json"}],"toc":"","author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}},"mapped":true,"prev_post":{"title":"CFNetwork 编程指南之一: 概览","uid":"a230e0658132bd7e51140146dce14c4f","slug":"CFNetwork-编程指南之一-概览","date":"2016-08-10T03:56:09.000Z","updated":"2016-08-19T08:33:23.000Z","comments":true,"path":"api/articles/CFNetwork-编程指南之一-概览.json","keywords":null,"cover":null,"text":"CFNetwork是核心服务框架中的一个框架，提供了抽象概念的网络协议库。这些抽象概念使得执行各种网络任务变得更容易，例如： 使用BSD套接字 使用SSL或TLS创建加密连接 解析DNS主机 使用HTTP，验证HTTP和HTTP服务器 使用FTP服务器 发布、解析和浏览Bonjo...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"iOS网络编程","slug":"iOS网络编程","count":9,"path":"api/categories/iOS网络编程.json"}],"tags":[{"name":"CFNetwork","slug":"CFNetwork","count":7,"path":"api/tags/CFNetwork.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}},"next_post":{"title":"iOS App上架流程","uid":"0be78fce7ff14abe5dd400a8b201abea","slug":"iOS-App-上架流程","date":"2016-08-08T14:16:57.000Z","updated":"2019-05-14T04:53:34.000Z","comments":true,"path":"api/articles/iOS-App-上架流程.json","keywords":null,"cover":[],"text":"准备条件: 1.一个已付费的开发者账号（账号类型分为个人（Individual）、公司（Company）、企业（Enterprise）、高校（University）四种类型，每年资费分别为$99、$99、$299、免费。）。2.你的Xcode必须是正式版的. 打开苹果开发者中心：...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":18,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"iOS上架App Store","slug":"iOS上架App-Store","count":1,"path":"api/tags/iOS上架App-Store.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}}}