{"title":"HomeKit 编程实例","uid":"10bb0d48f3c88565c60ee94c3f8f9c4f","slug":"HomeKit编程实例","date":"2016-08-10T10:20:01.000Z","updated":"2019-05-14T05:04:18.000Z","comments":true,"path":"api/articles/HomeKit编程实例.json","keywords":null,"cover":[],"content":"<!-- MFI (Made for iPod,Made for iPhone ,and Made for iPad) 认证是指 连接iPod,iPhone,iPad而特别设计的电子配件.并且这些配件已经被苹果公司授权认证,以此来满足苹果产品的性能标准. -->\n\n<p>#HomeKit智能家居平台</p>\n<p>随着物联网技术的发展,构建智能家居的技术越来越成熟,苹果公司制定了HomeKit智能家居平台硬件规格标准,第三方设备制造商将可以为苹果设备推出大量智能家居产品.设备商都必须参加MFI 授权计划,并严格遵守此前公布的硬件规格要求.</p>\n<p>HomeKit 硬件标准涵盖了包括蓝牙低功耗连接,WiFi连接和安全等规格设计,目前HomeKit只能家居设备包括风扇,车库门,电灯,锁,电源插座,数字开关和韩文琦等家用设备.</p>\n<p><img src=\"https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/HomeKitDeveloperGuide/Art/into_diagram_2x.png\"></p>\n<span id=\"more\"></span>\n<p>#HomeKit 开发框架<br>苹果公司给出了HomeKit 平台标准的同时给出了基于HomeKit开发框架 HomeKit.framework. 通过HomeKit框架可以开发基于苹果的设备客户端程序,开发人员不需要关系具体的配件的固件信息,不要关心如何与配件进行通信.HomeKit框架使智能家居的应用开发更加轻松,更加简单.</p>\n<p>#HomeKit 术语</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.Homes:家庭,用户可以有多个家庭,例如城市的商品房,郊外的别墅.<br> 2.Rooms:家庭中的房间,例如卧室,客厅和厨房等,一个家庭中有多个房间(比如两室一厅).<br> 3.Accessories:外部配件,它是实际智能家居配件,比如电风扇,车库门,电灯,油烟机.这些配件被安装在家庭中,并且又被分配给某个房间.<br> 4.Services:服务,是由配件提供的给用户控制的服务,比如电风扇的电源,电灯的亮度,油烟机的风速大小等.单个配件可以有多个控制服务.<br> 5.Zones: 区域,在家庭中可以对房间进行分组.这样便于控制.比如一楼的房间,孩子们的房间等.</p></blockquote>\n<p>这些术语对应的对象,在创建的时候需要指定一个唯一的名字,这个名字不仅仅在程序中使用,还可以通过Siri 发出命令,进行语音控制.</p>\n<p>HomeKit API<br>HomeKit 提供了智能家居开发所需的类和协议:</p>\n<p>主要类:</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.HMHomeManager:HMHomeManager对象管理一个或者多个家庭集合.<br> 2.HMHome:HMHome对象允许在家庭中安装配件已经进行通信.<br> 3.HMRoom:HMRoom对象被用来代表家庭的一个房间<br> 4.HMAccessory:HMAccessory对象代表一个智能家居配件,比如灯,恒温器<br> 5.HMAccessoryBrowser:HMAccessoryBrowser对象代表一个用来发现新配件的网络浏览器<br> 6.HMService:HMService对象代表提供的服务<br> 7.HMServiceGroup:HMServiceGroup对象代表配件提供的服务的集合,可以将多个服务当做一个实体处理.<br> 8.HMCharacteristic:HMCharacteristic对象代表某个服务的特性,比如灯打开.<br> 9.HMZone:HMZone对象代表一个家庭的集合区域.</p></blockquote>\n<p>主要协议:</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.HMHomeManagerDelegate:这个协议定义了HMHomeManager代理对象的接口<br> 2.HMHomeDelegate:该协议定义了家庭委托对象的接口<br> 3.HMAccessoryDelegate:该协议定义配件委托对象的接口,当配件状态更新时回调噶协议方法.<br> 4.HMAccessoryBrowserDelegate:HMAccessoryBrowser委托对象的接口,当发现了新的配件回调改协议方法.</p></blockquote>\n<p>#HomeKit 编程</p>\n<p>HomeKit编程的流程:</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.创建家庭<br>2.添加房间到家庭<br>3.查找配件<br>4.在家庭中安装配件<br>5.分配配件到家庭<br>6.从配件中找到服务<br>7.从服务中找到特征<br>8.通过特征读写配件状态*</p></blockquote>\n<p>上述流程分为两个阶段,1.创建家庭和房间,2.配件查找和控制.<br>创建家庭和房间包括:1,2.<br>配件查找和控制包括:3,4,5,6,7,8</p>\n<p>#实例:Philips Light bulb 控制设计</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming1.png\"></p>\n<p>##配置Xcode 工程<br>创建Philips Light bulb 的工程,开启HomeKit功能呢<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming2-1.png\"></p>\n<p>##核心代码</p>\n<p><code>ViewController.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">HomeKit</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewController</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">//家庭管理者</span>\n    <span class=\"token keyword\">var</span> homeManager <span class=\"token operator\">=</span> <span class=\"token function\">HMHomeManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>homeManager<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>navigationItem<span class=\"token punctuation\">.</span>leftBarButtonItem <span class=\"token operator\">=</span> editButtonItem\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Dispose of any resources that can be recreated.</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">// MARK: - UITableViewDelegate</span>\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">ViewController</span><span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> commit editingStyle<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewCellEditingStyle</span><span class=\"token punctuation\">,</span> forRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> editingStyle <span class=\"token operator\">==</span> <span class=\"token punctuation\">.</span>delete <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">//获取home</span>\n            <span class=\"token keyword\">let</span> home <span class=\"token operator\">=</span> homeManager<span class=\"token punctuation\">.</span>homes<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>indexPath <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSIndexPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n            homeManager<span class=\"token punctuation\">.</span><span class=\"token function\">removeHome</span><span class=\"token punctuation\">(</span>home<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span>  <span class=\"token punctuation\">&#123;</span>\n                    tableView<span class=\"token punctuation\">.</span><span class=\"token function\">deleteRows</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>automatic<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token comment\">// MARK: - UITableViewDataSource</span>\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">ViewController</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> homeManager<span class=\"token punctuation\">.</span>homes<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UITableViewCell</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cell\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> home <span class=\"token operator\">=</span> homeManager<span class=\"token punctuation\">.</span>homes<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>indexPath <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSIndexPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n        cell<span class=\"token punctuation\">.</span>textLabel<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> home<span class=\"token punctuation\">.</span>name\n        \n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token comment\">// MARK: - HMHomeManagerDelegate</span>\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">ViewController</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHomeManagerDelegate</span><span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">homeManagerDidUpdateHomes</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> manager<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHomeManager</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"home更新\"</span><span class=\"token punctuation\">)</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">homeManager</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> manager<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHomeManager</span><span class=\"token punctuation\">,</span> didRemove home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"home已经被移除\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span> segue<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIStoryboardSegue</span><span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> segue<span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">:</span> sender<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> segue<span class=\"token punctuation\">.</span>identifier <span class=\"token operator\">==</span> <span class=\"token string\">\"addHome\"</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">let</span> navController <span class=\"token operator\">=</span> segue<span class=\"token punctuation\">.</span>destination <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">UINavigationController</span>\n            <span class=\"token keyword\">let</span> addHomeViewController <span class=\"token operator\">=</span> navController<span class=\"token punctuation\">.</span>topViewController <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">AddHomeViewController</span>\n            addHomeViewController<span class=\"token punctuation\">.</span>homeManager <span class=\"token operator\">=</span> homeManager\n            \n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> segue<span class=\"token punctuation\">.</span>identifier <span class=\"token operator\">==</span> <span class=\"token string\">\"showRooms\"</span><span class=\"token punctuation\">&#123;</span>\n            \n            <span class=\"token keyword\">let</span> listRoomsViewController <span class=\"token operator\">=</span> segue<span class=\"token punctuation\">.</span>destination <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">ListRoomsViewController</span>\n            <span class=\"token keyword\">let</span> home <span class=\"token operator\">=</span> homeManager<span class=\"token punctuation\">.</span>homes<span class=\"token punctuation\">[</span>tableView<span class=\"token punctuation\">.</span>indexPathForSelectedRow<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n            \n            \n            listRoomsViewController<span class=\"token punctuation\">.</span>home <span class=\"token operator\">=</span> home\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>AddHomeViewController.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">HomeKit</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AddHomeViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> textField<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITextField</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">var</span> homeManager <span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHomeManager</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">var</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">// Do any additional setup after loading the view.</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n        textField<span class=\"token punctuation\">.</span><span class=\"token function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Dispose of any resources that can be recreated.</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//添加home</span>\n        homeManager<span class=\"token punctuation\">.</span><span class=\"token function\">addHome</span><span class=\"token punctuation\">(</span>withName<span class=\"token punctuation\">:</span> textField<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">(</span>home<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            \n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        \n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>AddRoomViewController.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">HomeKit</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AddRoomViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> textField<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITextField</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">var</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        home<span class=\"token punctuation\">.</span><span class=\"token function\">addRoom</span><span class=\"token punctuation\">(</span>withName<span class=\"token punctuation\">:</span> textField<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span>  <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">dismiss</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>DetailRoomViewController.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">HomeKit</span>\n<span class=\"token keyword\">let</span> accessoryName <span class=\"token operator\">=</span> <span class=\"token string\">\"Light\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DetailRoomViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">HMAccessoryBrowserDelegate</span> <span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token keyword\">var</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">var</span> room<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMRoom</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">var</span> lightAccessory<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMAccessory</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">var</span> accessoryBrowser <span class=\"token operator\">=</span> <span class=\"token function\">HMAccessoryBrowser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">var</span> brightnessCharacteristic<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMCharacteristic</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">var</span> powerStateCharacteristic<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMCharacteristic</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> powerSwitch<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISwitch</span><span class=\"token operator\">!</span>\n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> brightnessSilder<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISlider</span><span class=\"token operator\">!</span>\n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> brightnessValue<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UILabel</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>accessoryBrowser<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">findAccessory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidDisappear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidDisappear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>accessoryBrowser<span class=\"token punctuation\">.</span><span class=\"token function\">stopSearchingForNewAccessories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">findAccessory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        \n            <span class=\"token keyword\">for</span> accessory <span class=\"token keyword\">in</span> room<span class=\"token punctuation\">.</span>accessories <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">if</span> accessory<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> accessoryName <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>lightAccessory <span class=\"token operator\">=</span> accessory\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        \n        <span class=\"token comment\">// 开始查找配件</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>lightAccessory <span class=\"token operator\">==</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>accessoryBrowser<span class=\"token punctuation\">.</span><span class=\"token function\">startSearchingForNewAccessories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">findServicesForAccessory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>lightAccessory<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        \n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">//MARK: --实现HMAccessoryBrowserDelegate协议</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">accessoryBrowser</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> browser<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMAccessoryBrowser</span><span class=\"token punctuation\">,</span> didFindNewAccessory accessory<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMAccessory</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发现配件...\"</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">if</span> accessory<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> accessoryName <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>home<span class=\"token punctuation\">.</span><span class=\"token function\">addAccessory</span><span class=\"token punctuation\">(</span>accessory<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                \n                <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"安装配件失败。\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>home<span class=\"token punctuation\">.</span><span class=\"token function\">assignAccessory</span><span class=\"token punctuation\">(</span>accessory<span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>room<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                        <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">findServicesForAccessory</span><span class=\"token punctuation\">(</span>accessory<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span>\n                \n                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">findServicesForAccessory</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> accessory<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMAccessory</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"查找配件的服务...\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> service <span class=\"token keyword\">in</span> accessory<span class=\"token punctuation\">.</span>services <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" 服务名 = <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>service<span class=\"token punctuation\">.</span>name<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" 服务类型 = <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>service<span class=\"token punctuation\">.</span>serviceType<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            \n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" 查找服务中的特征...\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">findCharacteristicsOfService</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">findCharacteristicsOfService</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> service<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMService</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">for</span> characteristic <span class=\"token keyword\">in</span> service<span class=\"token punctuation\">.</span>characteristics <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"   特征类型 = <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>characteristic<span class=\"token punctuation\">.</span>characteristicType<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            \n            <span class=\"token keyword\">if</span> characteristic<span class=\"token punctuation\">.</span>characteristicType <span class=\"token operator\">==</span> <span class=\"token builtin\">HMCharacteristicTypeBrightness</span><span class=\"token punctuation\">&#123;</span>\n                brightnessCharacteristic <span class=\"token operator\">=</span> characteristic\n                brightnessCharacteristic<span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span>completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                    <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span>  <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token keyword\">let</span> oldValue <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>brightnessCharacteristic<span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">Float</span>\n                        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oldValue : <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>oldValue<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>brightnessSilder<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> oldValue\n                        <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>brightnessValue<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">:</span> <span class=\"token string\">\"%0.0f\"</span><span class=\"token punctuation\">,</span> oldValue<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span>\n                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n                \n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> characteristic<span class=\"token punctuation\">.</span>characteristicType <span class=\"token operator\">==</span> <span class=\"token builtin\">HMCharacteristicTypePowerState</span> <span class=\"token punctuation\">&#123;</span>\n                powerStateCharacteristic <span class=\"token operator\">=</span> characteristic\n                powerStateCharacteristic<span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span>completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                    <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span>  <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token keyword\">let</span> oldValue <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>powerStateCharacteristic<span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">Bool</span>\n                        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oldValue : <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>oldValue<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">self</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>powerSwitch<span class=\"token punctuation\">.</span><span class=\"token function\">setOn</span><span class=\"token punctuation\">(</span>oldValue<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span>\n                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">switchValueChanged</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> newValue <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>powerSwitch<span class=\"token punctuation\">.</span>isOn\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>powerStateCharacteristic<span class=\"token punctuation\">.</span><span class=\"token function\">writeValue</span><span class=\"token punctuation\">(</span>newValue<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Power状态写入失败: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">silderValueChanged</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> newValue <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>brightnessSilder<span class=\"token punctuation\">.</span>value\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>brightnessCharacteristic<span class=\"token punctuation\">.</span><span class=\"token function\">writeValue</span><span class=\"token punctuation\">(</span>newValue<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"亮度写入失败:<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>brightnessValue<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">:</span> <span class=\"token string\">\"%0.0f\"</span><span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>ListRoomsViewController.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">HomeKit</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ListRoomsViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewController</span> <span class=\"token punctuation\">,</span><span class=\"token builtin\">HMHomeDelegate</span><span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token keyword\">var</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        home<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">// MARK: - Table view data source</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> home<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UITableViewCell</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cell\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> room <span class=\"token operator\">=</span> home<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>indexPath <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSIndexPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n        cell<span class=\"token punctuation\">.</span>textLabel<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> room<span class=\"token punctuation\">.</span>name\n        \n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//MARK: --实现数据源协议</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> commit editingStyle<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewCellEditingStyle</span><span class=\"token punctuation\">,</span> forRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> editingStyle <span class=\"token operator\">==</span> <span class=\"token punctuation\">.</span>delete <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">let</span> room <span class=\"token operator\">=</span> home<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>indexPath <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSIndexPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n            home<span class=\"token punctuation\">.</span><span class=\"token function\">removeRoom</span><span class=\"token punctuation\">(</span>room<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                \n                <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span>  <span class=\"token punctuation\">&#123;</span>\n                    tableView<span class=\"token punctuation\">.</span><span class=\"token function\">deleteRows</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewRowAnimation</span><span class=\"token punctuation\">.</span>automatic<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//MARK: --实现HMHomeDelegate协议</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token punctuation\">,</span> didAdd room<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMRoom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"一个房间被创建\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> home<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMHome</span><span class=\"token punctuation\">,</span> didRemove room<span class=\"token punctuation\">:</span> <span class=\"token builtin\">HMRoom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"一个房间被删除\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span> segue<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIStoryboardSegue</span><span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> segue<span class=\"token punctuation\">,</span> sender<span class=\"token punctuation\">:</span> sender<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">if</span> segue<span class=\"token punctuation\">.</span>identifier <span class=\"token operator\">==</span> <span class=\"token string\">\"addRoom\"</span><span class=\"token punctuation\">&#123;</span>\n            \n            <span class=\"token keyword\">let</span> navController <span class=\"token operator\">=</span> segue<span class=\"token punctuation\">.</span>destination <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">UINavigationController</span>\n            <span class=\"token keyword\">let</span> addRoomViewController <span class=\"token operator\">=</span> navController<span class=\"token punctuation\">.</span>topViewController <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">AddRoomViewController</span>\n            addRoomViewController<span class=\"token punctuation\">.</span>home <span class=\"token operator\">=</span> home\n            \n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> segue<span class=\"token punctuation\">.</span>identifier <span class=\"token operator\">==</span> <span class=\"token string\">\"showDetailRoom\"</span> <span class=\"token punctuation\">&#123;</span>\n            \n            <span class=\"token keyword\">let</span> detailRoomViewController <span class=\"token operator\">=</span> segue<span class=\"token punctuation\">.</span>destination <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">DetailRoomViewController</span>\n            detailRoomViewController<span class=\"token punctuation\">.</span>home <span class=\"token operator\">=</span> home\n            \n            <span class=\"token keyword\">let</span> indexPath <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">.</span>indexPathForSelectedRow<span class=\"token operator\">!</span>\n            detailRoomViewController<span class=\"token punctuation\">.</span>room <span class=\"token operator\">=</span> home<span class=\"token punctuation\">.</span>rooms<span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>   \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>##运行测试</p>\n<p>开发者网站下载HardwareIOTools_Xcode_xx.dmg<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming2-2.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming3.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming4.png\"></p>\n<p>打开模拟器<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming5.png\"></p>\n<p>点击加号<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming6.png\"></p>\n<p>创建一个配件<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming7-2.png\"></p>\n<p>添加一个服务<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming8-2.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming9.png\"></p>\n<p>选择Light<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming10.png\"></p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming11-2.png\"></p>\n<p>运行App</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意:info.plist 填写 NSHomeKitUsageDescription</p></blockquote>\n<p>授权访问iCloud云端的homekit数据<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming12.PNG\"></p>\n<p>添加Home<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming13.PNG\"></p>\n<p>在刚刚添加的Home中添加Room<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming14.PNG\"></p>\n<p>授权添加配件<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming17.PNG\"></p>\n<p>添加room 和模拟器的配件进行配对<br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming15.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming16.png\"><br>完成配对,这个时候操作界面的开关,模拟器也会自动调整数据</p>\n<p><a href=\"https://github.com/williamxiewz/projectDemo/tree/master/homekit/Philips%20Light%20bulb\">项目源代码GitHub</a></p>\n<p><a href=\"https://pan.baidu.com/s/1JKY5kIewt0IbidzwbYBaww\">项目源代码BaiduPan</a></p>\n<p>#iOS10 Home app使用<br>Home app能够添加所有的HomeKit的配件.下面是一个门的例子</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming18.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming19.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming20.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming21.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming22.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming23.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming24.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming25.png\"><br><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/applehomekitprogramming26.png\"></p>\n","text":" #HomeKit智能家居平台 随着物联网技术的发展,构建智能家居的技术越来越成熟,苹果公司制定了HomeKit智能家居平台硬件规格标准,第三方设备制造商将可以为苹果设备推出大量智能家居产品.设备商都必须参加MFI 授权计划,并严格遵守此前公布的硬件规格要求. HomeKit 硬...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"智能家居","slug":"智能家居","count":2,"path":"api/categories/智能家居.json"}],"tags":[{"name":"HomeKit","slug":"HomeKit","count":2,"path":"api/tags/HomeKit.json"}],"toc":"","author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}},"mapped":true,"prev_post":{"title":"Bonjour网络编程","uid":"0cc4b6da7e6dbc367d1a0f5f752f14d7","slug":"Bonjour网络编程","date":"2016-08-10T10:53:34.000Z","updated":"2016-08-22T15:17:53.000Z","comments":true,"path":"api/articles/Bonjour网络编程.json","keywords":null,"cover":null,"text":"#Bonjour 介绍Bonjour(法语”你好’’的意思),它可以使应用不必指定眼务器端口和IP地址就可以以动态发现。 发现眼务是通过特定命名搜索服务的.例如”tony. _tonyipp. _tcp.local”这样的命名，发 现服务命名格式如下： &lt;服务名&gt;.〈...","link":"","photos":[],"count_time":{"symbolsCount":517,"symbolsTime":"1 mins."},"categories":[{"name":"iOS网络编程","slug":"iOS网络编程","count":9,"path":"api/categories/iOS网络编程.json"}],"tags":[{"name":"Bonjour","slug":"Bonjour","count":1,"path":"api/tags/Bonjour.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}},"next_post":{"title":"Handoff 编程指南","uid":"3ea9c69504bb57a512c185577723226c","slug":"Handoff-编程指南","date":"2016-08-10T10:10:28.000Z","updated":"2016-08-19T10:19:51.000Z","comments":true,"path":"api/articles/Handoff-编程指南.json","keywords":null,"cover":[],"text":"本文翻译自Apple官方文档：Handoff Programming Guide #关于Handoff Handoff是iOS 8 和 OS X v10.10中引入的功能，可以让同一个用户在多台设备间传递项目。 Handoff能让用户从一台设备开始一个项目，然后切换至其他设备继续...","link":"","photos":[],"count_time":{"symbolsCount":"32k","symbolsTime":"29 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":19,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"Handoff","slug":"Handoff","count":3,"path":"api/tags/Handoff.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}}}