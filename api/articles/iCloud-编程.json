{"title":"iCloud 编程","uid":"548f4e29db9400645bad688f092ca0b0","slug":"iCloud-编程","date":"2016-08-08T13:48:46.000Z","updated":"2016-08-23T02:49:57.000Z","comments":true,"path":"api/articles/iCloud-编程.json","keywords":null,"cover":null,"content":"<p>#iCloud简介</p>\n<p>iCloud 是苹果”云战略”的重要棋子，iCloud是苹果的云服务技术。它的重点是提供数据的存储服务，苹果给每个用户免费提供5GB的云服务空间。如果不够，用户可以付费购买更多的空间。苹果公司斥资 10亿美元在北卡罗莱纳州建设新数据中心-iDataCenter，该数据中心面积为50万平方英尺，也是美国最大规模的数据中心之一。 </p>\n<p>iCloud被整合到iOS 5和OS X 10.7. 4中，使用了这些设备的用户，只需在多个设备中设置苹果账号就可以同步、共享和备份数据。如图4-1所示，我的iphone设备上的通讯录可以同步到我的ipad和Mac Air电脑中。iCloud可以存放照片、文档等内容，以无线方式将它们推送到你的所有设备上。这都是自动在后台执行的，当打开电脑时候你会发现这些信息已经在那里了！</p>\n<p>使用iCLoud 服务除了能够存储特定应用数据,还可以通过编程方式存储自己应用的数据,iOS8 之后苹果支持4中类的iCloud存储:</p>\n<ul>\n<li>iCloud 键值数据存储</li>\n<li>iCloud 文档存储</li>\n<li>iCloud Core Data 技术</li>\n<li>iCloudKit 存储编程</li>\n</ul>\n<span id=\"more\"></span>\n<p>#iCloud 键值数据存储</p>\n<p>iCloud键值数据存储的应用场景是这样的：我有看电子书的习惯，经常在乘坐地铁的时候使用iphone看电子书，当看到精彩内容的时候，我到站了 ，于是我关闭了这个应用。当晚上回到家时，我想用Ipad躺在沙发上看那本电子书，而且我想接着那个精彩的地方开始看。一个设计良好的电子书应用应该是：当我使用ipad打开这本书的时候，它应该马上跳到我当初退出的地方。这需要开发人员记录下退出时的页码，并保存在icloud中，然后其他设备使用该应用的时候获取这些记录信息，以便于初始化应用。</p>\n<p>icloud键值数据存储，以一种键值对的方式存储简单类型数据，这些数据类型包括数字、日期、数组和字典等。数据结构是pust类型。每个应用只能存储64KB的数据。它也没有像文档存储那样有一套数据冲突解决方案，新的数据会覆盖旧的数据。因此，它经常用来存储系统设置、使用偏好以及应用的状态.</p>\n<p>iCloud键值数据存储编程比较简单,在API使用方面,<code>NSUbiquitousKeyValueStore类</code><br>它的使用类似于 <code>NSUserDefaults</code>,NSUserDefaults类 是苹果设计的访问本地系统的设置类.<br>而NSUbiquitousKeyValueStore类 是用来访问iCLoud 键值数据存储数据的.<br>NSUbiquitousKeyValueStore实例的获得也采用单例设计模式:</p>\n<pre><code>var store = NSUbiquitousKeyValueStore.defaultStore() \n</code></pre>\n<p>下面是NSUbiquitousKeyValueStore类的一些取值方法：</p>\n<ul>\n<li>boolForKey:根据键取出布尔值。 </li>\n<li>longLongForKey:根据键取出长整型值。</li>\n<li>objectForKey:根据键取出id类型值。</li>\n<li>stringForKey:根据键取出Nsstring类型值。 </li>\n<li>doubieForKey:根据键取出double类型值。</li>\n<li>arrayForKey;根据键取出数组类型值。 </li>\n<li>dictionaryForKey:根据键取出字典类型值。</li>\n<li>dataForKey:根据键取出NSData类型值。 </li>\n</ul>\n<p>下面是NSUbiquitousKeyValueStore类的一些赋值方法： </p>\n<ul>\n<li>setBoo]: forKey:根据键设置布尔值。 </li>\n<li>setLongLong: forKey:根据键设置长整型值。</li>\n<li>setObject; forKey:根据键设置id类型值。</li>\n<li>setString: forKey;根据键设置Nsstring类型值。</li>\n<li>setDouble: forKey:根据键设置double类型值。</li>\n<li>setArray: forKey:根据键设置数组类型值。</li>\n<li>setDictionary: forKey;根据键设置字典类型值。</li>\n<li>setData; forKey;根据键设置NSData类型值。 </li>\n</ul>\n<p>力了监听iCLoud键值数据存储据的变化，可以在程序中注册通知消息 <code>NSUbiquitousKeyValueStoreDidchangeExternallyNotification</code>，这个通知是当一个设备更新了iCloud中的键值数据时,iCloud服务器会发出这个通知,使得其他设备都接受到这个通知.</p>\n<p>##iCloud键值存储实例</p>\n<p>开启Capabilities&gt;iCloud&gt;Key-Value storage</p>\n<p>出现”&lt;工程名&gt;”. entilements 这个文件是授权文件,它保存了该工程的iCloud授权的详细配置信息.</p>\n<p>首先注册NSUbiquitousKeyValueStoreDidchangeExternallyNotification通知,并同步数据.</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n\n<span class=\"token comment\">//背景音乐 存储键</span>\n<span class=\"token keyword\">let</span> <span class=\"token builtin\">UbiquitousMusicKey</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"MusicKey\"</span>\n<span class=\"token comment\">//音效 存储键</span>\n<span class=\"token keyword\">let</span> <span class=\"token builtin\">UbiquitousSoundKey</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"SoundKey\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewController</span> <span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> switchMusic<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISwitch</span><span class=\"token operator\">!</span>    \n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> switchSound<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISwitch</span><span class=\"token operator\">!</span>\n    <span class=\"token comment\">//单例</span>\n    <span class=\"token keyword\">var</span> store <span class=\"token operator\">=</span> <span class=\"token builtin\">NSUbiquitousKeyValueStore</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//观察着指针</span>\n    <span class=\"token keyword\">var</span> storeDidChangeObserver <span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">//初始化控件状态</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchMusic<span class=\"token punctuation\">.</span><span class=\"token function\">setOn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">boolForKey</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UbiquitousMusicKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchSound<span class=\"token punctuation\">.</span><span class=\"token function\">setOn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">boolForKey</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UbiquitousSoundKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//添加观察者,改通知在iCloud服务数据变化时候触发,当客户端接受到该小心时会调用closure</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>storeDidChangeObserver <span class=\"token operator\">=</span> <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserverForName</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSUbiquitousKeyValueStoreDidChangeExternallyNotification</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">,</span> queue<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>note<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token comment\">//更新控件状态</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchMusic<span class=\"token punctuation\">.</span><span class=\"token function\">setOn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">boolForKey</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UbiquitousMusicKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchSound<span class=\"token punctuation\">.</span><span class=\"token function\">setOn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">boolForKey</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UbiquitousSoundKey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            \n            <span class=\"token keyword\">let</span> alert <span class=\"token operator\">=</span> <span class=\"token function\">UIAlertView</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"iCloud变更通知\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> <span class=\"token string\">\"你的iCloud存储数据已经变更\"</span><span class=\"token punctuation\">,</span> delegate<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">,</span> cancelButtonTitle<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Ok\"</span><span class=\"token punctuation\">)</span>\n            alert<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token comment\">//同步到iCloud 服务器</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">synchronize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>storeDidChangeObserver<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//存储iCloud服务器</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">setBool</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchMusic<span class=\"token punctuation\">.</span>on<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UbiquitousMusicKey</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">setBool</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>switchSound<span class=\"token punctuation\">.</span>on<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UbiquitousSoundKey</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">synchronize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>#iCloud文档存储</p>\n<p>文档存储 iCloud文梢存储的应用场景是这样的：我有一个备忘录应用，我在上班的路上突发奇<br>想，于是我用iphone记录下我好想法。然后，到公司的时候使用我的Mac Air运行我的备<br>忘录应用，我会发现应用刚才记录的方法同步到我的Mac Air中了。</p>\n<p>iCloud文档存储可以保存用户文档，用户在应用中创建文档，并通过 fcioud守护进程同步到icloud服务。文档类型没有限制，可以是文本文件、二进制文件。<br>存储空间与用户的可用icloud服务空间有关，在文档冲突方面icloud提供一套API帮助<br>解决这些问题。</p>\n<p>##iCloud存储运行过程 </p>\n<p>iCloud文档存储运行过程要比键值数据存储烦琐得多，将本地数据存储到iCloud服务器，大体分成3个步骤： </p>\n<p>步骤(1)<code>应用(App)</code>通过一个<code>Ubiquity容器标识</code>请求操作系统Ubiquity容器；<br>步骤(2)操作系统授权<code>应用(App)</code>可以访问Ubiquity容器；<br>步骤(3)通过Ubiquity容器实现与iCloud服务器传输数据。Ubiquity容器事实上也是设备上的目录，下面是运行在笔者设备某个应用的Ubiquity容器目录： </p>\n<p>/var/mobile/Library/Mobile % 20Documents/icloud〜cm〜51work6〜DoucmentDemo/</p>\n<p>而应用的沙箱目录：<br>/var/mobile/Containers/Data/Application/5A858EE6-F4FA-4462-835F-2AB8ED1994DA/Docuinents<br>可见沙箱目录与Ubiquity容器目录是不同的，使用的时候数据不能直接放在Ubiquity容器根目录下，而是要放在它的Documents子目录中，放入到这个目录中的数据可以自动同步到icioud服务器上，这个同步的过程开发者不用关系，由系统自动同步完成。</p>\n<p>##iCloud文档储存实例</p>\n<p>开启Capabilities&gt;iCloud&gt;iCloud Documents<br>出现”&lt;工程名&gt;”. entilements 这个文件是授权文件,它保存了该工程的iCloud授权的详细配置信息<br>Containers选择 User default container 使用默认的容器名 : <code>&quot;iCloud.&lt;应用BundleID&gt;&quot;</code><br>自定义文档类</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyCloudDocument</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIDocument</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">//保存文档数据 ,这个文档是本文文件,所以是NSString类型</span>\n    <span class=\"token keyword\">var</span> contents <span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSString</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token comment\">//加载数据</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">loadFromContents</span><span class=\"token punctuation\">(</span>contents<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">,</span> ofType typeName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">let</span> qContents <span class=\"token operator\">=</span> contents <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">NSData</span>\n        \n        <span class=\"token keyword\">if</span> qContents<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> <span class=\"token function\">NSString</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> qContents<span class=\"token punctuation\">,</span> encoding<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSUTF8StringEncoding</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//保存数据</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">contentsForType</span><span class=\"token punctuation\">(</span>typeName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">AnyObject</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> outError<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSError</span><span class=\"token operator\">!</span> <span class=\"token operator\">=</span> <span class=\"token function\">NSError</span><span class=\"token punctuation\">(</span>domain<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Migrator\"</span><span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> userInfo<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> resContents <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">.</span><span class=\"token function\">dataUsingEncoding</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSUTF8StringEncoding</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> resContents <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> value\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">throw</span> outError\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token comment\">//当前设备名</span>\n<span class=\"token keyword\">let</span> <span class=\"token builtin\">DeviceName</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">UIDevice</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> txtContent<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITextField</span><span class=\"token operator\">!</span>\n    <span class=\"token comment\">//自定义文档类</span>\n    <span class=\"token keyword\">var</span> myCloudDocument <span class=\"token punctuation\">:</span> <span class=\"token builtin\">MyCloudDocument</span><span class=\"token operator\">!</span>\n    <span class=\"token comment\">//查询元数据</span>\n    <span class=\"token keyword\">var</span> query <span class=\"token operator\">=</span> <span class=\"token function\">NSMetadataQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\">//请求本地Ubiquity容器，从容器中获得Document目录URL</span>\n    <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> ubiquitousDocumentsURL <span class=\"token punctuation\">:</span> <span class=\"token constant\">NSURL</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> fileManager <span class=\"token operator\">=</span> <span class=\"token builtin\">NSFileManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">var</span> containerURL <span class=\"token operator\">=</span> fileManager<span class=\"token punctuation\">.</span><span class=\"token function\">URLForUbiquityContainerIdentifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"iCloud.com.xxx.Demo\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Ubiquity容器 : <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>containerURL<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n        containerURL <span class=\"token operator\">=</span> containerURL<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">URLByAppendingPathComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Documents\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> containerURL\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">//为查询iCloud文件的变化，注册通知</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">:</span><span class=\"token string\">\"updateUbiquitousDocuments:\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSMetadataQueryDidFinishGatheringNotification</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">:</span><span class=\"token string\">\"updateUbiquitousDocuments:\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSMetadataQueryDidUpdateNotification</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">//注册文档状态变化通知</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">:</span> <span class=\"token string\">\"resolveConflict:\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIDocumentStateChangedNotification</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">//查询iCloud文件的变化</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>ubiquitousDocumentsURL <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>predicate <span class=\"token operator\">=</span> <span class=\"token function\">NSPredicate</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">:</span> <span class=\"token string\">\"%K like 'abc.txt'\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">NSMetadataItemFSNameKey</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>searchScopes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">NSMetadataQueryUbiquitousDocumentsScope</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewWillAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">enableUpdates</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">startQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidDisappear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">disableUpdates</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">stopQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    \n    <span class=\"token comment\">//当iCloud中的文件变化时候调用</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">updateUbiquitousDocuments</span><span class=\"token punctuation\">(</span>notification <span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSNotification</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//文件存在</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">let</span> ubiquityURL  <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">.</span><span class=\"token builtin\">last</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueForAttribute</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSMetadataItemURLKey</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token constant\">NSURL</span>\n            \n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument <span class=\"token operator\">=</span> <span class=\"token function\">MyCloudDocument</span><span class=\"token punctuation\">(</span>fileURL<span class=\"token punctuation\">:</span> ubiquityURL<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span><span class=\"token function\">openWithCompletionHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>success<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">if</span> success <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%@ : 打开iCloud文档\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">DeviceName</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>contents <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>contents <span class=\"token keyword\">as</span> <span class=\"token builtin\">String</span>\n                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span>  <span class=\"token string\">\"\"</span>\n                    <span class=\"token punctuation\">&#125;</span>\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">//文件不存在</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"文件不存在\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">let</span> documentiCloudPath <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>ubiquitousDocumentsURL<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">URLByAppendingPathComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc.txt\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument <span class=\"token operator\">=</span> <span class=\"token function\">MyCloudDocument</span><span class=\"token punctuation\">(</span>fileURL<span class=\"token punctuation\">:</span> documentiCloudPath<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span>text\n        <span class=\"token punctuation\">&#125;</span>\n        \n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">//注册CloudDocument对象到文档协调者，文档状态变化才能收到通知</span>\n            <span class=\"token builtin\">NSFileCoordinator</span><span class=\"token punctuation\">.</span><span class=\"token function\">addFilePresenter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">saveClick</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span>text\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span><span class=\"token function\">updateChangeCount</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UIDocumentChangeKind</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">Done</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span><span class=\"token function\">resignFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//文档冲突解决</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">resolveConflict</span><span class=\"token punctuation\">(</span>notification <span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSNotification</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span>\n            <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>documentState <span class=\"token operator\">==</span> <span class=\"token builtin\">UIDocumentState</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">InConflict</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"冲突发生\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token comment\">//文档冲突解决策略</span>\n                <span class=\"token keyword\">try</span> <span class=\"token builtin\">NSFileVersion</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeOtherVersionsOfItemAtURL</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>fileURL<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token number\">_</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token punctuation\">&#125;</span>\n            \n            <span class=\"token keyword\">let</span> conflictVersions <span class=\"token operator\">=</span> <span class=\"token builtin\">NSFileVersion</span><span class=\"token punctuation\">.</span><span class=\"token function\">unresolvedConflictVersionsOfItemAtURL</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>fileURL<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">for</span> item <span class=\"token keyword\">in</span> conflictVersions<span class=\"token operator\">!</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token keyword\">let</span> fileVersion <span class=\"token operator\">=</span> item \n                <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fileVersion.name = %@\"</span><span class=\"token punctuation\">,</span>fileVersion<span class=\"token punctuation\">.</span>modificationDate<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n                fileVersion<span class=\"token punctuation\">.</span>resolved <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>txtContent<span class=\"token punctuation\">.</span>text\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">.</span><span class=\"token function\">updateChangeCount</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UIDocumentChangeKind</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">Done</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">//从文档协调者中解除CloudDocument对象</span>\n            <span class=\"token builtin\">NSFileCoordinator</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeFilePresenter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>myCloudDocument<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span>\n\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>获取iCloud文档目录</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>查找Ubiquity 容器中的文档</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>iCloud中的文件变化处理</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>保存文档</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>解决文档冲突</p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n\n<p>#iCloud Core Data 技术<br>把一个文档保存在iCloud服务器端,文档的数据结构比较筒单,数据量也比较少，如果数据结构比较复杂，而是数据量相对大一些，再使用简单的数据结构文件就不能瞒住需求了,,可以考虑使用SQLite数据库,但是SQLite 是低级别数据持久化技术,而Core Data 是高级别的持久化技术,现在Core Data 可以借助于iCloud 技术奖户籍存到iCloud 服务中.</p>\n<p>##iCloud Core Data  实例<br>配置项目<br>iCloud Core Data 是基于iCloud 文档存储<br>Capablities&gt;iCloud&gt;iCloud Documents<br><code>CoreDataDAO.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">Foundation</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">CoreData</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CoreDataDAO</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSObject</span> <span class=\"token punctuation\">&#123;</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span> <span class=\"token punctuation\">,</span>\n            selector<span class=\"token punctuation\">:</span> #<span class=\"token function\">selector</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">CoreDataDAO</span><span class=\"token punctuation\">.</span><span class=\"token function\">contentDidChange</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            name<span class=\"token punctuation\">:</span><span class=\"token builtin\">NSPersistentStoreDidImportUbiquitousContentChangesNotification</span><span class=\"token punctuation\">,</span>\n            object<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>persistentStoreCoordinator<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token keyword\">deinit</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">// 返回应用程序Docment目录的NSURL类型</span>\n    <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> applicationDocumentsDirectory<span class=\"token punctuation\">:</span> <span class=\"token constant\">NSURL</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> urls <span class=\"token operator\">=</span> <span class=\"token builtin\">NSFileManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">URLsForDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">DocumentDirectory</span><span class=\"token punctuation\">,</span> inDomains<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token builtin\">UserDomainMask</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> urls<span class=\"token punctuation\">[</span>urls<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> \n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\">// MARK: - Core Data 堆栈</span>\n    <span class=\"token comment\">//返回 被管理的对象上下文</span>\n    <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> managedObjectContext<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> coordinator <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>persistentStoreCoordinator\n        <span class=\"token keyword\">if</span> coordinator <span class=\"token operator\">==</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant\">nil</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">var</span> managedObjectContext <span class=\"token operator\">=</span> <span class=\"token function\">NSManagedObjectContext</span><span class=\"token punctuation\">(</span>concurrencyType<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContextConcurrencyType</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">MainQueueConcurrencyType</span><span class=\"token punctuation\">)</span>\n        managedObjectContext<span class=\"token punctuation\">.</span>persistentStoreCoordinator <span class=\"token operator\">=</span> coordinator\n        <span class=\"token comment\">//合并策略</span>\n        managedObjectContext<span class=\"token punctuation\">.</span>mergePolicy <span class=\"token operator\">=</span> <span class=\"token builtin\">NSMergeByPropertyObjectTrumpMergePolicy</span>\n        <span class=\"token keyword\">return</span> managedObjectContext\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\">// 返回 持久化存储协调者</span>\n    <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> persistentStoreCoordinator<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSPersistentStoreCoordinator</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">var</span> coordinator<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSPersistentStoreCoordinator</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token function\">NSPersistentStoreCoordinator</span><span class=\"token punctuation\">(</span>managedObjectModel<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>managedObjectModel<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>applicationDocumentsDirectory<span class=\"token punctuation\">.</span><span class=\"token function\">URLByAppendingPathComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CoreDataNotes.sqlite\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">var</span> error<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSError</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token constant\">nil</span>\n        <span class=\"token keyword\">var</span> failureReason <span class=\"token operator\">=</span> <span class=\"token string\">\"There was an error creating or loading the application's saved data.\"</span>\n        \n        \n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">&#123;</span>\n            \n          <span class=\"token keyword\">let</span>  x <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> coordinator<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">addPersistentStoreWithType</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">NSSQLiteStoreType</span><span class=\"token punctuation\">,</span> configuration<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">:</span> url<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>iCloudPersistentStoreOptions<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">&#123;</span>\n        \n            coordinator <span class=\"token operator\">=</span> <span class=\"token constant\">nil</span>\n            <span class=\"token comment\">// Report any error we got.</span>\n            <span class=\"token keyword\">var</span> dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            \n            dict<span class=\"token punctuation\">[</span><span class=\"token builtin\">NSLocalizedDescriptionKey</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Failed to initialize the application's saved data\"</span>\n            dict<span class=\"token punctuation\">[</span><span class=\"token builtin\">NSLocalizedFailureReasonErrorKey</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> failureReason\n            dict<span class=\"token punctuation\">[</span><span class=\"token builtin\">NSUnderlyingErrorKey</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> error <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSError</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unresolved error <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token delimiter variable\">)</span></span>, <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span><span class=\"token punctuation\">(</span>error <span class=\"token keyword\">as</span> <span class=\"token builtin\">NSError</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>userInfo<span class=\"token delimiter variable\">)</span></span>\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">abort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n        \n        \n        \n<span class=\"token comment\">//        if coordinator!.addPersistentStoreWithType(NSSQLiteStoreType, configuration: nil, URL: url, options: self.iCloudPersistentStoreOptions, error: &amp;error) == nil &#123;</span>\n<span class=\"token comment\">//            coordinator = nil</span>\n<span class=\"token comment\">//            // Report any error we got.</span>\n<span class=\"token comment\">//            var dict = [String: AnyObject]()</span>\n<span class=\"token comment\">//            </span>\n<span class=\"token comment\">//            dict[NSLocalizedDescriptionKey] = \"Failed to initialize the application's saved data\"</span>\n<span class=\"token comment\">//            dict[NSLocalizedFailureReasonErrorKey] = failureReason</span>\n<span class=\"token comment\">//            dict[NSUnderlyingErrorKey] = error</span>\n<span class=\"token comment\">//            error = NSError(domain: \"51work6.com\", code: 9999, userInfo: dict)</span>\n<span class=\"token comment\">//            print(\"Unresolved error \\(error), \\(error!.userInfo)\")</span>\n<span class=\"token comment\">//            abort()</span>\n<span class=\"token comment\">//        &#125;</span>\n        \n        <span class=\"token keyword\">return</span> coordinator\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\">//  返回 被管理的对象模型</span>\n    <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> managedObjectModel<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectModel</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">let</span> modelURL <span class=\"token operator\">=</span> <span class=\"token builtin\">NSBundle</span><span class=\"token punctuation\">.</span><span class=\"token function\">mainBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">URLForResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CoreDataNotes\"</span><span class=\"token punctuation\">,</span> withExtension<span class=\"token punctuation\">:</span> <span class=\"token string\">\"momd\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">NSManagedObjectModel</span><span class=\"token punctuation\">(</span>contentsOfURL<span class=\"token punctuation\">:</span> modelURL<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    \n    <span class=\"token comment\">//使用这些配置</span>\n    <span class=\"token keyword\">var</span> iCloudPersistentStoreOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">NSPersistentStoreUbiquitousContentNameKey</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"iCloudMyNotesApp\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">contentDidChange</span><span class=\"token punctuation\">(</span>notification <span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSNotification</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token function\">NSLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%@\"</span><span class=\"token punctuation\">,</span> notification<span class=\"token punctuation\">.</span>userInfo<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>managedObjectContext<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">mergeChangesFromContextDidSaveNotification</span><span class=\"token punctuation\">(</span>notification<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">//投送通知更新UI</span>\n        <span class=\"token function\">dispatch_async</span><span class=\"token punctuation\">(</span><span class=\"token function\">dispatch_get_main_queue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">postNotificationName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"reloadViewNotification\"</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>#iCloudKit 存储编程</p>\n<p>iOS 8 推出了CloudKit 存储,并提供了一套API用来开发.此外提供了一个iCloud服务器Web 管理工具 — iCloud Dashboard(iCloud 仪表盘)</p>\n<p>在介绍CloudKit编程之前，有必要介绍一下CloudKit中的一些术语：</p>\n<ul>\n<li>容器：是应用的iCloud容器存储空间名字，在CloudKit容器类是CKContainer类。 </li>\n<li>数据库：iCloud容器中存储数据的区域，被分为两个数据库—公有数据库和私有数据库，公有数据库是所有用户都能访问的数据,而私有数据库只能允许用户自己访问。在CloudKit数据库类是CKDatabase类。</li>\n<li>记录类型（Record Type):相当于关系数据库中的表。 </li>\n<li>记录(Record) :相当于数据表中记录。在CloudKit数据库类是CKRecord类。 </li>\n<li>数据类型：记录（Record)中的字段是有数据类型的，他们分为database和asset两<br>种。database数据是一般的字符、数字、日期时间和地理经纬度坐标等类型；asset类型是用来存储图片、声音、视频等二进制数据。 </li>\n</ul>\n<p>iCloud Dashboard </p>\n<p>为了管理iCloud服务器，苹果提供了iCloud Dashboard的Web管理工具,可以通过网站<a href=\"https://icloud.developer.apple.com/dashboard/\">https://icloud.developer.apple.com/dashboard/</a>访问 或者在Xcodezhong 的CloudKit Dashboard按钮访问.</p>\n<p><img src=\"\"></p>\n<p>iCloud Dashboard左边导航菜单中有一些概念:</p>\n<ul>\n<li>Schema(模式):数据库对象的集合,iCloud中包含Record Type(记录类型),Security Role(安全角色）和Subscription Types(订阅类型).Record Type 可以管理记录类型,就是数据表; Security Roles定义角色，提供安全访问管理；Subscription Types可以订阅数据变化的通知。 </li>\n<li>Public Data: 公共数据库，其中包含User Records(用户记录),Default Zone(默认控件)和 Usage(用量)。User Records查看Users表中的数据，Users表的数据是由iCloud管理和维护的，开发人<br>员不能删除他们；Default Zone查看公共数据库表中数据。Usage提供了数据访问的统计报告。 </li>\n<li>Private Data:私有数据库，其中Default Zone查看私有数据库表中数据。需要注意的是，如果当前账户下没有任何数据，这个导航菜单是看不到的。 </li>\n<li>Admin:管理员功能，Team当需要多人协同开发一个项目时候，为他们提供一个统 一的访问权限。Deployment可以查看Schema修改日志；可以重新初始化开发环境;发布数据库。 </li>\n<li>Environment:切换Development(开发环境）和Production(产品环境）。 </li>\n</ul>\n<p>##CloudKit 实现实例</p>\n<p>Capabilities &gt; 开启iCloud &gt; CloudKit &gt; User default container </p>\n<p>iCloud 创建数据库<br>选择刚刚创建App对应的iCloud容器<br>Schema&gt;Record Types ,点击+ 创建表,填写表名 和 字段</p>\n<p><code>NoteDAO.swift</code></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">Foundation</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">CloudKit</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">NoteDAO</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">//定义iCloud 容器</span>\n    <span class=\"token keyword\">var</span> container <span class=\"token punctuation\">:</span> <span class=\"token builtin\">CKContainer</span><span class=\"token operator\">!</span>\n    <span class=\"token comment\">//定义database属性</span>\n    <span class=\"token keyword\">var</span> database <span class=\"token punctuation\">:</span>  <span class=\"token builtin\">CKDatabase</span><span class=\"token operator\">!</span>\n    <span class=\"token comment\">//单例类方法</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">var</span> sharedInstance<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NoteDAO</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">struct</span> <span class=\"token builtin\">Static</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">static</span> <span class=\"token keyword\">var</span> instance<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NoteDAO</span><span class=\"token operator\">?</span>\n            <span class=\"token keyword\">static</span> <span class=\"token keyword\">var</span> token<span class=\"token punctuation\">:</span> dispatch_once_t <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token punctuation\">&#125;</span>\n        \n        <span class=\"token function\">dispatch_once</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token builtin\">Static</span><span class=\"token punctuation\">.</span>token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            \n            <span class=\"token keyword\">let</span> dao <span class=\"token operator\">=</span> <span class=\"token function\">NoteDAO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            dao<span class=\"token punctuation\">.</span>container <span class=\"token operator\">=</span> <span class=\"token builtin\">CKContainer</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultContainer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//获得容器对象</span>\n            dao<span class=\"token punctuation\">.</span>database <span class=\"token operator\">=</span> dao<span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">.</span>publicCloudDatabase <span class=\"token comment\">// 获取共有数据库对象</span>\n                              <span class=\"token comment\">//container.privateCloudDatabase  // 获取私有数据库对象</span>\n            \n            <span class=\"token builtin\">Static</span><span class=\"token punctuation\">.</span>instance <span class=\"token operator\">=</span> dao\n            \n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">Static</span><span class=\"token punctuation\">.</span>instance<span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//插入Note方法</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Note</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//创建名为\"Note\"的数据库表记录</span>\n        <span class=\"token keyword\">let</span> record <span class=\"token operator\">=</span> <span class=\"token function\">CKRecord</span><span class=\"token punctuation\">(</span>recordType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Note\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//给记录设置 内容</span>\n        record<span class=\"token punctuation\">.</span><span class=\"token function\">setObject</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//给记录设置内容</span>\n        record<span class=\"token punctuation\">.</span><span class=\"token function\">setObject</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//数据库将记录对象插入到iCloud存储空间</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">saveRecord</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>recd<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error:<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>error<span class=\"token delimiter variable\">)</span></span>\"</span> <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"插入数据成功。\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//删除Note方法</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Note</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">//创建一个data查询条件对象</span>\n        <span class=\"token keyword\">let</span> predicate <span class=\"token operator\">=</span> <span class=\"token function\">NSPredicate</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">:</span> <span class=\"token string\">\"date = %@\"</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//查询对象</span>\n        <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token function\">CKQuery</span><span class=\"token punctuation\">(</span>recordType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Note\"</span><span class=\"token punctuation\">,</span> predicate<span class=\"token punctuation\">:</span> predicate<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//查询操作</span>\n        <span class=\"token keyword\">let</span> queryOperation <span class=\"token operator\">=</span> <span class=\"token function\">CKQueryOperation</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//设置recordFetchedBlock回调属性,查询结果返回的回调,根据查询记录的个数调用多次</span>\n        <span class=\"token comment\">//record 就是被查询到的记录</span>\n        queryOperation<span class=\"token punctuation\">.</span>recordFetchedBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> record <span class=\"token keyword\">in</span>\n            <span class=\"token comment\">//将从iCloud存储空间删除,根据ID进行删除.</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">deleteRecordWithID</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">.</span>recordID<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>recd<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error: %@\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"删除数据成功。\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token comment\">//执行查询操作</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">addOperation</span><span class=\"token punctuation\">(</span>queryOperation<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//修改Note方法</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">modify</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Note</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">let</span> predicate <span class=\"token operator\">=</span> <span class=\"token function\">NSPredicate</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">:</span> <span class=\"token string\">\"date = %@\"</span><span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token function\">CKQuery</span><span class=\"token punctuation\">(</span>recordType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Note\"</span><span class=\"token punctuation\">,</span> predicate<span class=\"token punctuation\">:</span> predicate<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//查询操作</span>\n        <span class=\"token keyword\">let</span> queryOperation <span class=\"token operator\">=</span> <span class=\"token function\">CKQueryOperation</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//查询完以后,进行修改操作</span>\n        queryOperation<span class=\"token punctuation\">.</span>recordFetchedBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> record <span class=\"token keyword\">in</span>\n            record<span class=\"token punctuation\">.</span><span class=\"token function\">setObject</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">//修改操作</span>\n            <span class=\"token keyword\">let</span> modifyOperation <span class=\"token operator\">=</span> <span class=\"token function\">CKModifyRecordsOperation</span><span class=\"token punctuation\">(</span>recordsToSave<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>record<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> recordIDsToDelete<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">//执行修改回调</span>\n            modifyOperation<span class=\"token punctuation\">.</span>perRecordCompletionBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>recd<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error: %@\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"修改数据成功。\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token comment\">//执行修改操作</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">addOperation</span><span class=\"token punctuation\">(</span>modifyOperation<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token comment\">//执行查询操作</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">addOperation</span><span class=\"token punctuation\">(</span>queryOperation<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//查询所有数据方法</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">let</span> listData <span class=\"token operator\">=</span> <span class=\"token function\">NSMutableArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//无条件的对象</span>\n        <span class=\"token keyword\">let</span> predicate <span class=\"token operator\">=</span> <span class=\"token function\">NSPredicate</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//不设置查询条件</span>\n        <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token function\">CKQuery</span><span class=\"token punctuation\">(</span>recordType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Note\"</span><span class=\"token punctuation\">,</span> predicate<span class=\"token punctuation\">:</span> predicate<span class=\"token punctuation\">)</span>\n        query<span class=\"token punctuation\">.</span>sortDescriptors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token function\">NSSortDescriptor</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">,</span> ascending<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\">//初始化QueryOperation</span>\n        <span class=\"token keyword\">let</span> queryOperation <span class=\"token operator\">=</span> <span class=\"token function\">CKQueryOperation</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//当提取数据时候设置</span>\n        queryOperation<span class=\"token punctuation\">.</span>recordFetchedBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> record <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> content <span class=\"token operator\">=</span> record<span class=\"token punctuation\">.</span><span class=\"token function\">objectForKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">String</span>\n            <span class=\"token keyword\">let</span> date <span class=\"token operator\">=</span> record<span class=\"token punctuation\">.</span><span class=\"token function\">objectForKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">NSDate</span>\n\n            <span class=\"token keyword\">let</span> note <span class=\"token operator\">=</span> <span class=\"token function\">Note</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">:</span> date<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span>content<span class=\"token punctuation\">)</span>\n            listData<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span>note<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    \n        queryOperation<span class=\"token punctuation\">.</span>queryCompletionBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error: %@\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token comment\">//投送通知更新UI</span>\n                <span class=\"token function\">dispatch_async</span><span class=\"token punctuation\">(</span><span class=\"token function\">dispatch_get_main_queue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span> <span class=\"token keyword\">in</span>\n                    <span class=\"token builtin\">NSNotificationCenter</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">postNotificationName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"reloadViewNotification\"</span><span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">:</span> listData<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        \n        <span class=\"token comment\">//执行查询操作</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">addOperation</span><span class=\"token punctuation\">(</span>queryOperation<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n    \n    <span class=\"token comment\">//按照主键查询数据方法</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Note</span><span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">&#123;</span>\n        \n        <span class=\"token keyword\">var</span> note <span class=\"token punctuation\">:</span> <span class=\"token builtin\">Note</span><span class=\"token operator\">!</span>\n        \n        <span class=\"token keyword\">let</span> predicate <span class=\"token operator\">=</span> <span class=\"token function\">NSPredicate</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//不设置查询条件</span>\n        <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token function\">CKQuery</span><span class=\"token punctuation\">(</span>recordType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Note\"</span><span class=\"token punctuation\">,</span> predicate<span class=\"token punctuation\">:</span> predicate<span class=\"token punctuation\">)</span>\n        query<span class=\"token punctuation\">.</span>sortDescriptors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token function\">NSSortDescriptor</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">,</span> ascending<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\">//初始化QueryOperation</span>\n        <span class=\"token keyword\">let</span> queryOperation <span class=\"token operator\">=</span> <span class=\"token function\">CKQueryOperation</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">//当提取数据时候设置</span>\n        queryOperation<span class=\"token punctuation\">.</span>recordFetchedBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> record <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> content <span class=\"token operator\">=</span> record<span class=\"token punctuation\">.</span><span class=\"token function\">objectForKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">String</span>\n            <span class=\"token keyword\">let</span> date <span class=\"token operator\">=</span> record<span class=\"token punctuation\">.</span><span class=\"token function\">objectForKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">NSDate</span>\n            \n            note <span class=\"token operator\">=</span> <span class=\"token function\">Note</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">:</span> date<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span>content<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n        \n        queryOperation<span class=\"token punctuation\">.</span>queryCompletionBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">(</span>cursor<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">if</span> error <span class=\"token operator\">!=</span> <span class=\"token constant\">nil</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error: %@\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token comment\">//投送通知更新UI</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span>\n        \n        <span class=\"token comment\">//执行查询操作</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>database<span class=\"token punctuation\">.</span><span class=\"token function\">addOperation</span><span class=\"token punctuation\">(</span>queryOperation<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","text":"#iCloud简介 iCloud 是苹果”云战略”的重要棋子，iCloud是苹果的云服务技术。它的重点是提供数据的存储服务，苹果给每个用户免费提供5GB的云服务空间。如果不够，用户可以付费购买更多的空间。苹果公司斥资 10亿美元在北卡罗莱纳州建设新数据中心-iDataCenter...","link":"","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":18,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"iCloud","slug":"iCloud","count":1,"path":"api/tags/iCloud.json"}],"toc":"","author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}},"mapped":true,"prev_post":{"title":"iOS App上架流程","uid":"0be78fce7ff14abe5dd400a8b201abea","slug":"iOS-App-上架流程","date":"2016-08-08T14:16:57.000Z","updated":"2019-05-14T04:53:34.000Z","comments":true,"path":"api/articles/iOS-App-上架流程.json","keywords":null,"cover":[],"text":"准备条件: 1.一个已付费的开发者账号（账号类型分为个人（Individual）、公司（Company）、企业（Enterprise）、高校（University）四种类型，每年资费分别为$99、$99、$299、免费。）。2.你的Xcode必须是正式版的. 打开苹果开发者中心：...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":18,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"iOS上架App Store","slug":"iOS上架App-Store","count":1,"path":"api/tags/iOS上架App-Store.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}},"next_post":{"title":"Handoff 编程","uid":"e22bf8154724897227d91eac96e617a1","slug":"Handoff-编程","date":"2016-08-08T13:41:38.000Z","updated":"2019-05-14T04:53:36.000Z","comments":true,"path":"api/articles/Handoff-编程.json","keywords":null,"cover":[],"text":" #Handoff技术介绍 Handoff是苹果“融合”主题中的重要元素之一，同时也是iOS8和OS X Yosemite中新的“Continuity”特征集的一部分。“Continuity”功能包含了能跨平台兼容的AirDrop、可在iPad和Mac上拨打iPhone电话和处理...","link":"","photos":[],"count_time":{"symbolsCount":"16k","symbolsTime":"15 mins."},"categories":[{"name":"iOS SDK","slug":"iOS-SDK","count":18,"path":"api/categories/iOS-SDK.json"}],"tags":[{"name":"Handoff","slug":"Handoff","count":3,"path":"api/tags/Handoff.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}}}