{"title":"iOS app性能优化系列二: Analyze静态分析","uid":"4dc896d7a59383baffa315f4498bf870","slug":"iOS-app性能优化系列二-Analyze静态分析","date":"2016-08-19T06:20:45.000Z","updated":"2019-05-14T04:53:33.000Z","comments":true,"path":"api/articles/iOS-app性能优化系列二-Analyze静态分析.json","keywords":null,"cover":[],"content":"<p>#Analyze静态分析</p>\n<p>在App进行Build或Archive时，会产生很多编译警告，这些警告是编译时产生的，静态分析的过程也类似，在XCode Product菜单下，点击Analyze对App进行静态分析。</p>\n<span id=\"more\"></span>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledevelopxcodeinstrumentsAnalyze1.png\"></p>\n<p>Analyze主要分析以下四种问题：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、逻辑错误：访问空指针或未初始化的变量等；<br>2、内存管理错误：如内存泄漏等；<br>3、声明错误：从未使用过的变量；<br>4、API调用错误：未包含使用的库和框架。</p></blockquote>\n<p>##Analyze内存泄漏分析</p>\n<p>声明错误、逻辑错误、Api调用错误基本在编译时都会有警告，Analyze的主要优势在于静态分析内存泄漏及代码逻辑错误。</p>\n<p>比如在开启arc的环境下，输入以下一段代码：</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token comment\">//截取部分图像</span>\n<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>UIImage<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>getSubImage<span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span>ulUserHeader\n<span class=\"token punctuation\">&#123;</span>\n    UIImage <span class=\"token operator\">*</span> sourceImage <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>UIImage imageNamed<span class=\"token operator\">:</span>@<span class=\"token string\">\"header.png\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    CGFloat height <span class=\"token operator\">=</span> sourceImage<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n    CGRect rect <span class=\"token operator\">=</span> <span class=\"token function\">CGRectMake</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token operator\">+</span> ulUserHeader<span class=\"token operator\">*</span>height<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     \n    CGImageRef imageRef <span class=\"token operator\">=</span> <span class=\"token function\">CGImageCreateWithImageInRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sourceImage CGImage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    UIImage<span class=\"token operator\">*</span> smallImage <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>UIImage imageWithCGImage<span class=\"token operator\">:</span>imageRef<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//CGImageRelease(imageRef);</span>\n     \n    <span class=\"token keyword\">return</span> smallImage<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>用注释注释掉CGImageRelease(imageRef)这行，虽然开起了arc，不过仍然会导致imageRef对象泄漏。</p>\n<p>使用Analyze进行分析，在导航栏Analyze选择Analyzer查看分析结果：</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledevelopxcodeinstrumentsAnalyze2.png\"></p>\n<p>Analyze已经分析出imageRef对象有内存泄漏，这种情况在编译时是无法发现的。</p>\n<p>如果你没有使用ARC，那么Analyze更有用。</p>\n<p>Analyze的其他三种分析也可以使用，相比编译器给出的信息更明确。</p>\n<p>##Analyze逻辑错误监测</p>\n<p><img src=\"https://github.com/williamxiewz/williamxie-github-io/raw/master/appledevelopxcodeinstrumentsAnalyze3.png\"></p>\n<p>这种情况在codereview时也较难发现，可以借助Analyze。</p>\n<p>如上代码，当Tag不等于1、2和3的时候，就会出现很问题了。</p>\n<p>Analyze还给出了箭头提示：len is a garbage value。建议在声明变量时，同时进行初始化。</p>\n","text":"#Analyze静态分析 在App进行Build或Archive时，会产生很多编译警告，这些警告是编译时产生的，静态分析的过程也类似，在XCode Product菜单下，点击Analyze对App进行静态分析。 Analyze主要分析以下四种问题： 1、逻辑错误：访问空指针或未初...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/categories/iOS-app性能优化.json"}],"tags":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/tags/iOS-app性能优化.json"},{"name":"instruments","slug":"instruments","count":19,"path":"api/tags/instruments.json"}],"toc":"","author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}},"mapped":true,"prev_post":{"title":"iOS app性能优化系列二: Activity Monitor活动监视器","uid":"97a2dac7e69ff8e29acf006c8ec1041e","slug":"iOS-app性能优化系列二-Activity-Monitor活动监视器","date":"2016-08-19T06:21:17.000Z","updated":"2016-08-19T06:30:58.000Z","comments":true,"path":"api/articles/iOS-app性能优化系列二-Activity-Monitor活动监视器.json","keywords":null,"cover":null,"text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/categories/iOS-app性能优化.json"}],"tags":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/tags/iOS-app性能优化.json"},{"name":"instruments","slug":"instruments","count":19,"path":"api/tags/instruments.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}},"next_post":{"title":"iOS app性能优化系列一: instruments","uid":"1cbcb76715126955837c5dfa9e5a18a7","slug":"iOS-app性能优化系列一-instruments","date":"2016-08-19T06:20:14.000Z","updated":"2016-08-19T06:31:11.000Z","comments":true,"path":"api/articles/iOS-app性能优化系列一-instruments.json","keywords":null,"cover":null,"text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/categories/iOS-app性能优化.json"}],"tags":[{"name":"iOS app性能优化","slug":"iOS-app性能优化","count":19,"path":"api/tags/iOS-app性能优化.json"},{"name":"instruments","slug":"instruments","count":19,"path":"api/tags/instruments.json"}],"author":{"name":"William Xie","slug":"blog-author","avatar":"/img/author.png","link":"/","description":"","socials":{"github":"https://github.com/williamxiewz","twitter":"https://twitter.com/williamxie_wz","stackoverflow":"http://stackoverflow.com/users/4078104/goingxiebin-jobs","wechat":"","qq":"","weibo":"https://weibo.com/u/2281381063","zhihu":"https://www.zhihu.com/people/williamxiewz","csdn":"https://blog.csdn.net/u014222645","juejin":"https://juejin.cn/user/3280598430133277","customs":{}}}}}